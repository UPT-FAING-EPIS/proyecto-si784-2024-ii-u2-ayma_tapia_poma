name: Mutation Testing

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  mutation_testing:
    runs-on: ubuntu-latest

    steps:
    # Clona el c贸digo del repositorio
    - name: Checkout code
      uses: actions/checkout@v3

    # Configura PHP
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2' # PHP 8.2
        extensions: xdebug # Necesario para la cobertura de c贸digo

    # Instala las dependencias de Composer en la carpeta project
    - name: Install dependencies
      run: |
        cd project
        composer install

    # Instala Infection PHP para pruebas mutantes (si es necesario para otras pruebas)
    - name: Install Infection PHP
      run: |
        cd project
        composer require infection/infection --dev

    # Da permisos de ejecuci贸n a Infection
    - name: Set execute permissions for Infection
      run: |
        cd project
        chmod +x vendor/bin/infection

    # Copia el archivo Clover XML existente para generar el informe HTML
    - name: Copy existing Clover XML
      run: |
        mkdir -p project/coverage
        cp /path/to/your/clover.xml project/coverage/clover.xml

    # Genera el reporte en HTML a partir del archivo Clover XML existente
    - name: Generate HTML Mutation Report from Clover XML
      run: |
        cd project
        vendor/bin/infection --coverage-html=coverage/html-report

    # Mueve el reporte de mutaci贸n generado a la carpeta de informes
    - name: Move mutation report to target folder
      run: |
        cd project
        mkdir -p ../proyecto-si784-2024-ii-u2-ayma_tapia_poma/project/informes/mutacion
        cp -r coverage/html-report/* ../proyecto-si784-2024-ii-u2-ayma_tapia_poma/project/informes/mutacion/

    # (Opcional) Sube el informe como artefacto para descargarlo desde GitHub
    - name: Upload mutation report as artifact
      uses: actions/upload-artifact@v3
      with:
        name: mutation-test-report
        path: proyecto-si784-2024-ii-u2-ayma_tapia_poma/project/informes/mutacion/
